generator client {
  provider = "prisma-client-js"
  output   = "./generated/"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model chat {
  id         Int         @id @default(autoincrement())
  created_at DateTime?   @default(now()) @db.Timestamptz(6)
  message    message[]
  user_chat  user_chat[]
}

model message {
  id         Int       @id @default(autoincrement())
  chat_id    Int
  sender_id  Int
  content    String?
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  chat       chat      @relation(fields: [chat_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       user      @relation(fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model user {
  id            Int         @id @default(autoincrement())
  username      String      @unique(map: "user_username_idx") @db.VarChar(32)
  avatar        String?
  password_hash String
  created_at    DateTime?   @default(now()) @db.Timestamptz(6)
  message       message[]
  user_chat     user_chat[]
}

model user_chat {
  id          Int       @id @default(autoincrement())
  user_id     Int
  chat_id     Int
  last_opened DateTime? @default(now()) @db.Timestamptz(6)
  chat        chat      @relation(fields: [chat_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user        user      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, chat_id])
}
